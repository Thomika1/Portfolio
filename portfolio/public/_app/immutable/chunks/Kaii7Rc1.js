import{c as d,r as p,d as o,p as v,a as u,b as l,h as k,e as _,m,s as g,f as M,g as w,u as y,q as S,S as A}from"./CP6BfUbc.js";class q{anchor;#s=new Map;#t=new Map;#e=new Map;#i=new Set;#a=!0;constructor(e,t=!0){this.anchor=e,this.#a=t}#r=()=>{var e=d;if(this.#s.has(e)){var t=this.#s.get(e),i=this.#t.get(t);if(i)p(i),this.#i.delete(t);else{var a=this.#e.get(t);a&&(this.#t.set(t,a.effect),this.#e.delete(t),a.fragment.lastChild.remove(),this.anchor.before(a.fragment),i=a.effect)}for(const[s,r]of this.#s){if(this.#s.delete(s),s===e)break;const h=this.#e.get(r);h&&(o(h.effect),this.#e.delete(r))}for(const[s,r]of this.#t){if(s===t||this.#i.has(s))continue;const h=()=>{if(Array.from(this.#s.values()).includes(s)){var n=document.createDocumentFragment();m(r,n),n.append(u()),this.#e.set(s,{effect:r,fragment:n})}else o(r);this.#i.delete(s),this.#t.delete(s)};this.#a||!i?(this.#i.add(s),v(r,h,!1)):h()}}};#f=e=>{this.#s.delete(e);const t=Array.from(this.#s.values());for(const[i,a]of this.#e)t.includes(i)||(o(a.effect),this.#e.delete(i))};ensure(e,t){var i=d,a=g();if(t&&!this.#t.has(e)&&!this.#e.has(e))if(a){var s=document.createDocumentFragment(),r=u();s.append(r),this.#e.set(e,{effect:l(()=>t(r)),fragment:s})}else this.#t.set(e,l(()=>t(this.anchor)));if(this.#s.set(i,e),a){for(const[h,c]of this.#t)h===e?i.unskip_effect(c):i.skip_effect(c);for(const[h,c]of this.#e)h===e?i.unskip_effect(c.effect):i.skip_effect(c.effect);i.oncommit(this.#r),i.ondiscard(this.#f)}else k&&(this.anchor=_),this.#r()}}function b(f,e){return f===e||f?.[A]===e}function x(f={},e,t,i){return M(()=>{var a,s;return w(()=>{a=s,s=[],y(()=>{f!==t(...s)&&(e(f,...s),a&&b(t(...a),f)&&e(null,...a))})}),()=>{S(()=>{s&&b(t(...s),f)&&e(null,...s)})}}),f}export{q as B,x as b};
